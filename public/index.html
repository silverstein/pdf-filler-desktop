<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Filler - Free AI-Powered PDF Processing</title>
    
    <!-- Theme CSS -->
    <link rel="stylesheet" href="themes.css">
    <!-- CSS -->

    <!-- Lucide Icons (local) -->
    <script src="js/lucide.min.js"></script>
    <link rel="stylesheet" href="styles.css">

    
</head>
<body class="theme-mono">
    <!-- Header should be FIRST and FULL WIDTH -->
    <header class="header">
        <div style="display: flex; align-items: center;">
            <h1>
                <div class="logo-icon">
                    <i data-lucide="file-text" style="width: 20px; height: 20px;"></i>
                </div>
                <span>PDF Filler</span>
                <span id="appVersion" style="font-size: 0.7em; opacity: 0.7; margin-left: 8px;"></span>
            </h1>
        </div>
        <div class="header-controls">
            <div class="status">
                <div class="account-dropdown">
                    <div class="account-trigger" id="accountTrigger">
                        <span class="status-dot" id="geminiStatus"></span>
                        <span id="geminiStatusText">Checking...</span>
                        <span style="font-size: 0.75rem;">▼</span>
                    </div>
                    <div class="account-menu" id="accountMenu">
                        <div class="account-menu-item" id="accountEmail" style="font-weight: 500; border-bottom: 1px solid var(--border);">
                            <!-- Email will be inserted here -->
                        </div>
                        <button class="account-menu-item" onclick="signOut()">
                            <i data-lucide="log-out" style="width: 16px; height: 16px;"></i>
                            <span>Sign Out</span>
                        </button>
                        <button class="account-menu-item" onclick="switchAccount()">
                            <i data-lucide="refresh-cw" style="width: 16px; height: 16px;"></i>
                            <span>Switch Account</span>
                        </button>
                        <button id="chatgptSignInMenu" class="account-menu-item" onclick="handleChatGPTSignIn()">
                            <i data-lucide="message-circle" style="width: 16px; height: 16px;"></i>
                            <span>Sign in with ChatGPT</span>
                        </button>
                        <button id="claudeSignInMenu" class="account-menu-item" onclick="handleClaudeSignIn()">
                            <i data-lucide="brain" style="width: 16px; height: 16px;"></i>
                            <span>Sign in with Claude</span>
                        </button>
                        <div class="account-menu-separator"></div>
                        <button id="logoutMenu" class="account-menu-item" onclick="handleLogout()" style="display: none;">
                            <i data-lucide="log-out" style="width: 16px; height: 16px;"></i>
                            <span>Sign Out</span>
                        </button>
                    </div>
                </div>
                <div class="status-indicator" id="providerBadge">
                    <span id="providerBadgeText">Detecting...</span>
                </div>
            </div>
            <button class="icon-btn" id="settingsBtn" onclick="toggleSettings()" title="Settings">
                <span style="font-size: 18px; line-height: 1;">⚙</span>
            </button>
        </div>
    </header>

    <!-- App container with sidebar and main -->
    <div class="app-layout">
        <!-- Sidebar on LEFT -->
        <!-- Recent Files Sidebar -->
        <aside class="sidebar" id="recentFilesSidebar">
        <div class="sidebar-header">
            <h3><i data-lucide="clock" style="width: 18px; height: 18px;"></i> Recent Files</h3>
        </div>
        <div class="sidebar-content">
            <div class="sidebar-search">
                <i data-lucide="search" style="width: 16px; height: 16px;"></i>
                <input type="text" id="recentFilesSearch" placeholder="Search files..." class="search-input">
            </div>
            <div class="recent-files-list" id="recentFilesList">
                <div class="no-recent-files">
                    <i data-lucide="file-text" style="width: 32px; height: 32px; opacity: 0.3;"></i>
                    <p>No recent files</p>
                    <small>Upload a PDF to get started</small>
                </div>
            </div>
        </div>
        <div class="sidebar-actions">
            <button class="clear-history-btn" id="clearRecentFiles">
                <i data-lucide="trash-2" style="width: 16px; height: 16px;"></i>
                Clear History
            </button>
        </div>
        </aside>

        <!-- Main content on RIGHT -->
        <main class="main-content">
        <div class="container">
            <!-- Auth Section -->
        <div id="authSection" class="auth-section" style="display: none;">
            <div class="auth-card">
                <h1>Welcome to PDF Filler</h1>
                <p>Sign in with your Google account to start processing PDFs for free</p>
                
                <button id="googleSignIn" class="google-signin-btn" onclick="handleGoogleSignIn()">
                    <svg width="20" height="20" viewBox="0 0 48 48" style="margin-right: 8px;">
                        <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/>
                        <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/>
                        <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/>
                        <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/>
                    </svg>
                    Sign in with Google
</button>
                
                <button id="chatgptSignIn" class="google-signin-btn" style="margin-top: 0.75rem; display: inline-flex; align-items: center;" onclick="handleChatGPTSignIn()">
                    <i data-lucide="message-circle" style="width: 20px; height: 20px; margin-right: 8px;"></i>
                    Sign in with ChatGPT
                </button>
                
                <button id="claudeSignIn" class="google-signin-btn" style="margin-top: 0.75rem; display: inline-flex; align-items: center;" onclick="handleClaudeSignIn()">
                    <i data-lucide="brain" style="width: 20px; height: 20px; margin-right: 8px;"></i>
                    Sign in with Claude
                </button>
                
                <div class="auth-info">
                    <p><strong>✨ Completely Free</strong></p>
                    <p>Using Google's generous Gemini free tier:</p>
                    <ul>
                        <li>60 requests per minute</li>
                        <li>1,000 requests per day</li>
                        <li>1M token context window</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- Settings View -->
        <div class="settings-view" id="settingsView">
            <div class="settings-header">
                <button class="icon-btn" onclick="toggleSettings()" style="display: flex; align-items: center; justify-content: center;">
                    <span style="font-size: 18px; line-height: 0; display: inline-block; transform: translateY(1px);">←</span>
                </button>
                <h2>Settings</h2>
            </div>
            
            <div class="settings-section">
                <h3><i data-lucide="palette" style="width: 20px; height: 20px; display: inline-block; vertical-align: text-bottom;"></i> Theme</h3>
                <div class="theme-grid">
                    <div class="theme-card" data-theme="brutalist" onclick="selectTheme('brutalist')">
                        <div class="theme-preview" style="background: #000; color: #0F0;">[ ]</div>
                        <h4>Brutalist Mono</h4>
                        <small>Terminal-inspired design</small>
                    </div>
                    <div class="theme-card" data-theme="glassmorphic" onclick="selectTheme('glassmorphic')">
                        <div class="theme-preview" style="background: linear-gradient(135deg, #6366F1, #8B5CF6); color: white;">◈</div>
                        <h4>Glassmorphic</h4>
                        <small>Modern transparency</small>
                    </div>
                    <div class="theme-card" data-theme="neubrutalism" onclick="selectTheme('neubrutalism')">
                        <div class="theme-preview" style="background: #FF0080; color: white;">■</div>
                        <h4>Neubrutalism</h4>
                        <small>Bold and playful</small>
                    </div>
                    <div class="theme-card" data-theme="gruvbox" onclick="selectTheme('gruvbox')">
                        <div class="theme-preview" style="background: #fbf1c7; color: #282828; border: 2px solid #d5c4a1;">
                            <i data-lucide="sun" style="width: 24px; height: 24px;"></i>
                        </div>
                        <h4>Gruvbox Light</h4>
                        <small>Warm retro comfort</small>
                    </div>
                    <div class="theme-card" data-theme="mono" onclick="selectTheme('mono')">
                        <div class="theme-preview" style="background: #FFFFFF; color: #000000; border: 1px solid #000000;">
                            <i data-lucide="square" style="width: 24px; height: 24px;"></i>
                        </div>
                        <h4>Mono</h4>
                        <small>Minimal with Geist</small>
                    </div>
                </div>
            </div>
            
            <div class="settings-section">
                <h3><i data-lucide="bar-chart-2" style="width: 20px; height: 20px; display: inline-block; vertical-align: text-bottom;"></i> Usage Limits</h3>
                <p>You're using Google's generous free tier:</p>
                <ul style="margin-left: 1.5rem; opacity: 0.8;">
                    <li>60 requests per minute</li>
                    <li>1,000 requests per day</li>
                    <li>1M token context window</li>
                </ul>
            </div>
            
            <div class="settings-section">
                <h3><i data-lucide="info" style="width: 20px; height: 20px; display: inline-block; vertical-align: text-bottom;"></i> About</h3>
                <p style="opacity: 0.8;">PDF Filler v1.0.0<br>
                Created by Mat Silverstein<br>
                Powered by Google Gemini AI</p>
            </div>
        </div>
        
        <div class="upload-area" id="mainApp" style="display: none;">
            <h2 class="upload-title">AI-Powered PDF Processing</h2>
            <p class="upload-subtitle">Powered by Google Gemini's free tier</p>

            <div class="drop-zone" id="dropZone">
                <div class="drop-zone-icon">
                    <i data-lucide="upload" style="width: 48px; height: 48px;"></i>
                </div>
                <p>Drag your PDF here</p>
                <small>or click to browse</small>
                <input type="file" id="fileInput" class="file-input" accept=".pdf">
            </div>

            <!-- Quick Info Card (shows instantly) -->
            <div class="quick-info-card" id="quickInfoCard" style="display: none;">
                <div class="quick-info-header">
                    <h3>
                        <i data-lucide="info" style="width: 20px; height: 20px;"></i>
                        File Information
                    </h3>
                    <button class="quick-info-toggle" onclick="toggleQuickInfo()">
                        <i data-lucide="chevron-down" style="width: 16px; height: 16px;"></i>
                    </button>
                </div>
                <div class="quick-info-content" id="quickInfoContent">
                    <div class="quick-info-grid">
                        <div class="info-item">
                            <span class="info-label">File Name:</span>
                            <span class="info-value" id="qiFileName">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">File Size:</span>
                            <span class="info-value" id="qiFileSize">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Pages:</span>
                            <span class="info-value" id="qiPages">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">PDF Version:</span>
                            <span class="info-value" id="qiVersion">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Form Fields:</span>
                            <span class="info-value" id="qiFormFields">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Has Signatures:</span>
                            <span class="info-value" id="qiSignatures">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Encrypted:</span>
                            <span class="info-value" id="qiEncrypted">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Created:</span>
                            <span class="info-value" id="qiCreated">-</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Intelligence Card -->
            <div class="intelligence-card" id="intelligenceCard" style="display: none;">
                <div class="intelligence-header">
                    <h3>
                        <i data-lucide="sparkles" style="width: 20px; height: 20px;"></i>
                        Document Intelligence
                    </h3>
                    <button class="intelligence-refresh" onclick="refreshIntelligence()">
                        <i data-lucide="refresh-cw" style="width: 16px; height: 16px;"></i>
                    </button>
                </div>
                <div class="intelligence-content" id="intelligenceContent">
                    <div class="intelligence-loading">
                        <div class="spinner-small"></div>
                        <span>Analyzing document...</span>
                    </div>
                </div>
            </div>

            <div class="rate-limits">
                <h4><i data-lucide="activity" style="width: 18px; height: 18px; display: inline-block; vertical-align: text-bottom;"></i> Usage Limits (Free Tier)</h4>
                <div class="limits">
                    <div class="limit-item">
                        <div class="limit-value" id="minuteLimit">60</div>
                        <div class="limit-label">per minute</div>
                    </div>
                    <div class="limit-item">
                        <div class="limit-value" id="dayLimit">1000</div>
                        <div class="limit-label">per day</div>
                    </div>
                    <div class="limit-item">
                        <div class="limit-value">1M</div>
                        <div class="limit-label">token context</div>
                    </div>
                </div>
            </div>

            <div class="processing" id="processing">
                <div class="spinner"></div>
                <p id="processingText">Processing with AI...</p>
                <small style="display: block; margin-top: 10px;">
                    This may take 30 seconds to 2 minutes for complex PDFs
                </small>
                <div id="processingTimer" style="margin-top: 10px; font-size: 0.9em;"></div>
            </div>

            <div class="results" id="results">
                <div class="result-header">
                    <h3>Results</h3>
                    <button class="copy-btn" id="copyBtn" onclick="copyToClipboard()">
                        <i id="copyIcon" data-lucide="clipboard" style="width: 16px; height: 16px;"></i>
                        <span id="copyText">Copy JSON</span>
                    </button>
                </div>
                <div class="result-content" id="resultContent" onclick="copyToClipboard()">
                    <span class="copy-tooltip">Click to copy</span>
                </div>
                <button onclick="downloadResult()" style="margin-top: 1rem;">Download Result</button>
            </div>

            <div class="error-message" id="errorMessage"></div>
        </div>

        <!-- Results area - ALWAYS VISIBLE (moved outside upload-area to be a grid sibling) -->
        <div class="results-area" id="resultsSection">
            <!-- Actions moved here from upload-area -->
            <div class="actions">
                <div class="action-card" data-action="extract">
                    <h3><i data-lucide="database" style="width: 20px; height: 20px; display: inline-block; vertical-align: text-bottom;"></i> Extract Data</h3>
                    <p>Convert PDF content to JSON</p>
                </div>
                <div class="action-card" data-action="fill">
                    <h3><i data-lucide="pen-tool" style="width: 20px; height: 20px; display: inline-block; vertical-align: text-bottom;"></i> Fill Form</h3>
                    <p>Auto-fill PDF forms with data</p>
                </div>
                <div class="action-card" data-action="bulk-fill">
                    <h3><i data-lucide="layers" style="width: 20px; height: 20px; display: inline-block; vertical-align: text-bottom;"></i> Bulk Fill</h3>
                    <p>Fill multiple forms with CSV data</p>
                </div>
                <div class="action-card" data-action="validate">
                    <h3><i data-lucide="check-circle" style="width: 20px; height: 20px; display: inline-block; vertical-align: text-bottom;"></i> Validate</h3>
                    <p>Check required fields</p>
                </div>
                <div class="action-card" data-action="profiles">
                    <h3><i data-lucide="user" style="width: 20px; height: 20px; display: inline-block; vertical-align: text-bottom;"></i> Profiles</h3>
                    <p>Manage saved form data</p>
                </div>
            </div>
            
            <h3 style="margin-top: 2rem;">Analysis Results</h3>
            <div class="results-placeholder">
                <i data-lucide="file-search" style="width: 32px; height: 32px; opacity: 0.3;"></i>
                <p>Upload and analyze a PDF to see results</p>
            </div>
        </div>
        </main>
    </div>

    
    <!-- Mobile Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Form Fill Modal -->
    <div class="modal-overlay" id="formFillModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i data-lucide="pen-tool" style="width: 20px; height: 20px;"></i>
                    Fill PDF Form
                </h3>
                <button class="modal-close" onclick="closeFormFillModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Password section (shown if PDF is protected) -->
                <div class="password-section" id="passwordSection" style="display: none;">
                    <h4>
                        <i data-lucide="lock" style="width: 16px; height: 16px;"></i>
                        Password Protected PDF
                    </h4>
                    <p>This PDF requires a password to access form fields.</p>
                    <div class="form-field">
                        <label for="pdfPassword">PDF Password</label>
                        <input type="password" id="pdfPassword" placeholder="Enter PDF password">
                        <button type="button" onclick="submitPassword()" style="margin-top: 0.5rem;" class="btn-primary">
                            <i data-lucide="unlock" style="width: 16px; height: 16px; margin-right: 0.5rem;"></i>
                            Unlock PDF
                        </button>
                    </div>
                </div>

                <!-- Loading state -->
                <div class="modal-loading" id="modalLoading">
                    <div class="spinner"></div>
                    <p>Reading form fields...</p>
                </div>

                <!-- Profile Section -->
                <div id="profileSection" style="display: none; margin-bottom: 1.5rem;">
                    <div style="display: flex; gap: 1rem; align-items: center; margin-bottom: 1rem;">
                        <select id="profileSelect" style="flex: 1; padding: 0.5rem; border: 1px solid var(--border); border-radius: 4px; background: var(--surface); color: var(--text);">
                            <option value="">Select a profile...</option>
                        </select>
                        <button class="btn-secondary" id="loadProfileBtn" onclick="loadSelectedProfile()" disabled>
                            <i data-lucide="upload" style="width: 16px; height: 16px; margin-right: 0.5rem;"></i>
                            Load
                        </button>
                        <button class="btn-secondary" id="saveAsProfileBtn" onclick="openSaveProfileModal()">
                            <i data-lucide="save" style="width: 16px; height: 16px; margin-right: 0.5rem;"></i>
                            Save as Profile
                        </button>
                    </div>
                </div>

                <!-- Form fields container -->
                <div id="formFieldsContainer" style="display: none;">
                    <p style="margin-bottom: 1.5rem; opacity: 0.8;">Fill in the form fields below. Leave fields empty to keep their current values.</p>
                    <div id="formFields"></div>
                </div>

                <!-- Error message -->
                <div id="modalError" style="display: none; color: var(--error); padding: 1rem; background: var(--surface-hover); border-radius: 4px; margin-bottom: 1rem;"></div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeFormFillModal()">Cancel</button>
                <button class="btn-primary" id="fillFormBtn" onclick="fillAndSavePDF()" disabled>
                    <i data-lucide="download" style="width: 16px; height: 16px; margin-right: 0.5rem;"></i>
                    Fill & Save PDF
                </button>
            </div>
        </div>
    </div>

    <!-- Profile Management Modal -->
    <div class="modal-overlay" id="profileModal">
        <div class="modal modal-large">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i data-lucide="user" style="width: 20px; height: 20px;"></i>
                    Profile Manager
                </h3>
                <button class="modal-close" onclick="closeProfileModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Profile List Section -->
                <div id="profileListSection">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h4 style="margin: 0; display: flex; align-items: center; gap: 0.5rem;">
                            <i data-lucide="list" style="width: 18px; height: 18px;"></i>
                            Saved Profiles
                        </h4>
                        <div style="display: flex; gap: 0.75rem;">
                            <button class="btn-secondary" onclick="exportProfiles()">
                                <i data-lucide="download" style="width: 16px; height: 16px; margin-right: 0.5rem;"></i>
                                Export
                            </button>
                            <button class="btn-secondary" onclick="importProfiles()">
                                <i data-lucide="upload" style="width: 16px; height: 16px; margin-right: 0.5rem;"></i>
                                Import
                            </button>
                            <button class="btn-primary" onclick="openCreateProfileModal()">
                                <i data-lucide="plus" style="width: 16px; height: 16px; margin-right: 0.5rem;"></i>
                                New Profile
                            </button>
                        </div>
                    </div>
                    
                    <div id="profileList" style="max-height: 400px; overflow-y: auto;">
                        <div class="loading-profiles" style="text-align: center; padding: 2rem; opacity: 0.6;">
                            <i data-lucide="loader-2" style="width: 24px; height: 24px; animation: spin 1s linear infinite;"></i>
                            <p style="margin-top: 0.5rem;">Loading profiles...</p>
                        </div>
                    </div>
                </div>

                <div id="profileModalError" style="display: none; color: var(--error); padding: 1rem; background: var(--surface-hover); border-radius: 4px; margin-top: 1rem;"></div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeProfileModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Save Profile Modal -->
    <div class="modal-overlay" id="saveProfileModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i data-lucide="save" style="width: 20px; height: 20px;"></i>
                    Save Profile
                </h3>
                <button class="modal-close" onclick="closeSaveProfileModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-field">
                    <label for="profileName">Profile Name *</label>
                    <input type="text" id="profileName" placeholder="e.g., Personal Info, Company Details" required>
                </div>
                <div class="form-field">
                    <label for="profileDescription">Description</label>
                    <textarea id="profileDescription" placeholder="Brief description of this profile..." rows="3"></textarea>
                </div>
                <div class="form-field">
                    <label for="profileTags">Tags (comma-separated)</label>
                    <input type="text" id="profileTags" placeholder="e.g., personal, work, address">
                </div>
                <div class="form-field">
                    <label>
                        <input type="checkbox" id="setAsDefault" style="margin-right: 0.5rem;">
                        Set as default profile
                    </label>
                </div>
                <div id="saveProfileError" style="display: none; color: var(--error); padding: 1rem; background: var(--surface-hover); border-radius: 4px; margin-top: 1rem;"></div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeSaveProfileModal()">Cancel</button>
                <button class="btn-primary" id="saveProfileBtn" onclick="saveProfile()">
                    <i data-lucide="save" style="width: 16px; height: 16px; margin-right: 0.5rem;"></i>
                    Save Profile
                </button>
            </div>
        </div>
    </div>

    <!-- Create/Edit Profile Modal -->
    <div class="modal-overlay" id="createProfileModal">
        <div class="modal modal-large">
            <div class="modal-header">
                <h3 class="modal-title" id="createProfileTitle">
                    <i data-lucide="plus" style="width: 20px; height: 20px;"></i>
                    Create New Profile
                </h3>
                <button class="modal-close" onclick="closeCreateProfileModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                    <div>
                        <div class="form-field">
                            <label for="createProfileName">Profile Name *</label>
                            <input type="text" id="createProfileName" placeholder="e.g., Personal Info" required>
                        </div>
                        <div class="form-field">
                            <label for="createProfileDescription">Description</label>
                            <textarea id="createProfileDescription" placeholder="Brief description..." rows="2"></textarea>
                        </div>
                        <div class="form-field">
                            <label for="createProfileTags">Tags (comma-separated)</label>
                            <input type="text" id="createProfileTags" placeholder="e.g., personal, work">
                        </div>
                        <div class="form-field">
                            <label>
                                <input type="checkbox" id="createSetAsDefault" style="margin-right: 0.5rem;">
                                Set as default profile
                            </label>
                        </div>
                    </div>
                    <div>
                        <h4 style="margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            <i data-lucide="edit-3" style="width: 18px; height: 18px;"></i>
                            Profile Data
                        </h4>
                        <div id="createProfileFields" style="max-height: 300px; overflow-y: auto; padding: 1rem; background: var(--surface-hover); border-radius: 4px;">
                            <p style="opacity: 0.6; text-align: center;">Common form fields will appear here</p>
                        </div>
                    </div>
                </div>
                <div id="createProfileError" style="display: none; color: var(--error); padding: 1rem; background: var(--surface-hover); border-radius: 4px; margin-top: 1rem;"></div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeCreateProfileModal()">Cancel</button>
                <button class="btn-primary" id="createProfileBtn" onclick="createProfile()">
                    <i data-lucide="save" style="width: 16px; height: 16px; margin-right: 0.5rem;"></i>
                    <span id="createProfileBtnText">Create Profile</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Hidden file input for profile import -->
    <input type="file" id="profileImportInput" accept=".json" style="display: none;">

    <!-- Bulk Fill Modal -->
    <div class="modal-overlay" id="bulkFillModal">
        <div class="modal modal-large">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i data-lucide="layers" style="width: 20px; height: 20px;"></i>
                    Bulk Fill PDFs
                </h3>
                <button class="modal-close" onclick="closeBulkFillModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Setup Section -->
                <div id="bulkSetupSection">
                    <p style="margin-bottom: 1.5rem; opacity: 0.8;">Fill multiple PDFs using data from a CSV file. Each row in the CSV will create a filled PDF.</p>
                    
                    <div class="form-field">
                        <label for="templatePDF">Template PDF</label>
                        <div class="file-selector">
                            <input type="text" id="templatePDF" readonly placeholder="Select your template PDF file...">
                            <button type="button" class="btn-secondary" onclick="selectTemplatePDF()">
                                <i data-lucide="file-plus" style="width: 16px; height: 16px; margin-right: 0.5rem;"></i>
                                Browse
                            </button>
                        </div>
                    </div>

                    <div class="form-field">
                        <label for="csvFile">CSV Data File</label>
                        <div class="file-selector">
                            <input type="text" id="csvFile" readonly placeholder="Select your CSV data file...">
                            <button type="button" class="btn-secondary" onclick="selectCSVFile()">
                                <i data-lucide="table" style="width: 16px; height: 16px; margin-right: 0.5rem;"></i>
                                Browse
                            </button>
                        </div>
                        <small style="opacity: 0.7; margin-top: 0.25rem; display: block;">CSV should have column headers matching form field names</small>
                    </div>

                    <div class="form-field">
                        <label for="outputDirectory">Output Directory</label>
                        <div class="file-selector">
                            <input type="text" id="outputDirectory" readonly placeholder="Select where to save filled PDFs...">
                            <button type="button" class="btn-secondary" onclick="selectOutputDirectory()">
                                <i data-lucide="folder" style="width: 16px; height: 16px; margin-right: 0.5rem;"></i>
                                Browse
                            </button>
                        </div>
                    </div>

                    <div class="form-field">
                        <label for="namingPattern">File Naming Pattern</label>
                        <input type="text" id="namingPattern" placeholder="filled_{row}_{timestamp}" value="filled_{row}_{timestamp}">
                        <div class="naming-pattern-help">
                            Available variables:<br>
                            • <code>{row}</code> - Row number (1, 2, 3...)<br>
                            • <code>{timestamp}</code> - Current timestamp<br>
                            • <code>{column_name}</code> - Any CSV column value (e.g., {name}, {id})
                        </div>
                    </div>

                    <!-- Password section (shown if template PDF is protected) -->
                    <div class="password-section" id="bulkPasswordSection" style="display: none;">
                        <h4>
                            <i data-lucide="lock" style="width: 16px; height: 16px;"></i>
                            Password Protected PDF
                        </h4>
                        <p>This template PDF requires a password to access form fields.</p>
                        <div class="form-field">
                            <label for="bulkPdfPassword">PDF Password</label>
                            <input type="password" id="bulkPdfPassword" placeholder="Enter PDF password">
                        </div>
                    </div>
                </div>

                <!-- Processing Section -->
                <div id="bulkProcessingSection" style="display: none;">
                    <div class="progress-container">
                        <div class="progress-text" id="bulkProgressText">Preparing to process files...</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="bulkProgressFill"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 0.875rem; opacity: 0.8;">
                            <span id="bulkProgressCount">0 / 0</span>
                            <span id="bulkProgressPercent">0%</span>
                        </div>
                    </div>

                    <div class="results-summary" id="bulkResultsSummary" style="display: none;">
                        <div class="result-stat">
                            <div class="result-stat-value" id="successCount">0</div>
                            <div class="result-stat-label">Successful</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-stat-value" id="failureCount">0</div>
                            <div class="result-stat-label">Failed</div>
                        </div>
                    </div>

                    <div id="bulkErrorContainer" style="display: none;">
                        <h4 style="margin: 1rem 0 0.5rem 0; color: var(--error);">Errors</h4>
                        <div class="error-list" id="bulkErrorList"></div>
                    </div>
                </div>

                <!-- Error message -->
                <div id="bulkModalError" style="display: none; color: var(--error); padding: 1rem; background: var(--surface-hover); border-radius: 4px; margin-bottom: 1rem;"></div>
            </div>
            <div class="modal-footer">
                <div class="bulk-actions">
                    <button class="btn-secondary" onclick="closeBulkFillModal()">Cancel</button>
                    <button class="btn-secondary" id="downloadSummaryBtn" onclick="downloadBulkSummary()" style="display: none;">
                        <i data-lucide="download" style="width: 16px; height: 16px; margin-right: 0.5rem;"></i>
                        Download Summary
                    </button>
                    <button class="btn-primary" id="startBulkFillBtn" onclick="startBulkFill()" disabled>
                        <i data-lucide="play" style="width: 16px; height: 16px; margin-right: 0.5rem;"></i>
                        Start Processing
                    </button>
                </div>
            </div>
        </div>
    </div>

    
    <!-- Update manager module -->
    <script src="js/utils/update-manager.js" defer></script>
    <script src="js/app.js" defer></script>
    <!-- Keyboard shortcuts module - loaded after app.js -->
    <script src="js/utils/keyboard-shortcuts.js" defer></script>
</body>
</html>
